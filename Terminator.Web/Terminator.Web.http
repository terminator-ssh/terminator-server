@baseUrl = http://localhost:5000/api/v1
@username = john_connor

# mock
@authSalt = AQIDBAUGBwgJCgsMDQ4PEA==
@keySalt = ERITFBUWFxgZGhscHR4fIA==
@loginKey = YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY= 
@encryptedMasterKey = SGVsbG8gV29ybGQgVGhpcyBpcyBhIE1hc3RlciBLZXk=

# admin
@adminUsername = admin
@adminPassword = admin


### 1. Register User
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "{{username}}",
  "authSalt": "{{authSalt}}",
  "keySalt": "{{keySalt}}",
  "encryptedMasterKey": "{{encryptedMasterKey}}",
  "loginKey": "{{loginKey}}"
}

### 2. Preflight (Get Salts to derive keys)
POST {{baseUrl}}/auth/preflight
Content-Type: application/json

{
  "username": "{{username}}"
}

### 3. Login (Get JWT)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "{{username}}",
  "loginKey": "{{loginKey}}"
}

> {%
    // because rider is stupid
    client.global.set("authToken", response.body.accessToken);
%}

### 4. Sync - First Push
POST {{baseUrl}}/sync
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "blobs": [
    {
      "id": "11111111-1111-1111-1111-111111111111",
      "updatedAt": "2024-04-21T10:00:00.000Z",
      "isDeleted": false,
      "iv": "Q0NDQ0NDQ0NDQ0ND",
      "blob": "eyJkYXRhIjoiVGhpcyBpcyBteSBmaXJzdCBzc2gga2V5In0="
    },
    {
      "id": "22222222-2222-2222-2222-222222222222",
      "updatedAt": "2024-04-21T11:00:00.000Z",
      "isDeleted": false,
      "iv": "ODg4ODg4ODg4ODg4",
      "blob": "eyJkYXRhIjoiQW5vdGhlciBzZWNyZXQga2V5IGRhdGEifQ=="
    }
  ],
  "lastSyncTime": "2024-04-21T09:00:00.000Z"
}

### 5. Sync - Stale Data (Should receive updates back)
POST {{baseUrl}}/sync
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "blobs": [
    {
      "id": "11111111-1111-1111-1111-111111111111",
      "updatedAt": "2023-04-21T10:00:00.000Z",
      "isDeleted": false,
      "iv": "Q0NDQ0NDQ0NDQ0ND",
      "blob": "eyJkYXRhIjoiVGhpcyBpcyBteSBmaXJzdCBzc2gga2V5In0="
    }
  ],
  "lastSyncTime": "2024-05-21T09:00:00.000Z"
}

### 6. Sync - Incremental Update + Delete
POST {{baseUrl}}/sync
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "blobs": [
    {
      "id": "11111111-1111-1111-1111-111111111111",
      "updatedAt": "2024-05-22T09:30:00.000Z",
      "isDeleted": false,
      "iv": "ODg4ODg4ODg4ODg4",
      "blob": "eyJkYXRhIjoiVGhpcyBpcyBteSBVUERBVEVEIHNzaCBrZXkifQ=="
    },
    {
      "id": "22222222-2222-2222-2222-222222222222",
      "updatedAt": "2024-05-22T09:35:00.000Z",
      "isDeleted": true,
      "iv": "Q0NDQ0NDQ0NDQ0ND",
      "blob": "eyJkYXRhIjoiQW5vdGhlciBzZWNyZXQga2V5IGRhdGEifQ=="
    }
  ],
  "lastSyncTime": "2024-05-21T12:00:00.000Z"
}

### 7. Sync - Empty (Just Check for Updates)
POST {{baseUrl}}/sync
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "blobs": [],
  "lastSyncTime": "2024-05-22T10:00:00.000Z"
}

### 8. Sync - Invalid IV Length (Should fail validation)
POST {{baseUrl}}/sync
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "blobs": [
    {
      "id": "33333333-3333-3333-3333-333333333333",
      "updatedAt": "2024-05-23T14:00:00.000Z",
      "isDeleted": false,
      "iv": "SGVsbG8=",
      "blob": "eyJkYXRhIjoiSW52YWxpZCBJViBkYXRhIn0="
    }
  ],
  "lastSyncTime": "2024-05-22T10:00:00.000Z"
}

### 9. Admin Login
POST {{baseUrl}}/auth/admin/login
Content-Type: application/json

{
  "username": "{{adminUsername}}",
  "password": "{{adminPassword}}"
}

> {%
    client.global.set("adminToken", response.body.accessToken);
%}

### 10. List All Users (Admin Only)
GET {{baseUrl}}/user/list
Authorization: Bearer {{adminToken}}

### 11. Delete User (Admin Only)
@targetUserId = 505421e0-d030-47a3-bb84-119b2bc4b62a

DELETE {{baseUrl}}/user/{{targetUserId}}
Authorization: Bearer {{adminToken}}

### 12. Create New Admin (Admin Only)
POST {{baseUrl}}/auth/admin/register
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "username": "super_admin",
  "password": "SuperStrongPassword123!"
}

### 13. Change Admin Password
POST {{baseUrl}}/auth/admin/changePassword
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newPassword": "newadmin"
}